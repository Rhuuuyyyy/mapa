{% extends "base.html" %}

{% block title %}Dashboard - MAPA SaaS{% endblock %}

{% block content %}
<div class="dashboard">
    <header class="dashboard-header">
        <h1>üìä Meus Relat√≥rios MAPA</h1>
        <div class="header-actions">
            <span class="user-badge" id="userName">Carregando...</span>
            <button onclick="logout()" class="btn btn-secondary">Sair</button>
        </div>
    </header>
    
    <div class="dashboard-content">
        <!-- Info Cards -->
        <div class="info-cards">
            <div class="info-card">
                <div class="info-card-header">
                    <span class="info-card-icon">üìÑ</span>
                    <h3>Upload de NF-e</h3>
                </div>
                <p>Fa√ßa upload de suas Notas Fiscais Eletr√¥nicas nos formatos XML ou PDF (DANFE) para processamento autom√°tico.</p>
                <ul>
                    <li>‚úÖ Suporta XML de NF-e</li>
                    <li>‚úÖ Suporta PDF da DANFE</li>
                    <li>‚úÖ Extra√ß√£o autom√°tica de dados</li>
                </ul>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">
                    <span class="info-card-icon">‚öôÔ∏è</span>
                    <h3>Processamento</h3>
                </div>
                <p>Os arquivos s√£o processados automaticamente ap√≥s o upload, extraindo todas as informa√ß√µes relevantes.</p>
                <ul>
                    <li>üì¶ Dados do produto e garantias</li>
                    <li>üè¢ Emitente e destinat√°rio</li>
                    <li>üí∞ Valores e quantidades</li>
                </ul>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">
                    <span class="info-card-icon">üìä</span>
                    <h3>Relat√≥rio MAPA</h3>
                </div>
                <p>Gere o relat√≥rio trimestral no formato oficial do MAPA com um clique.</p>
                <ul>
                    <li>üìã Formato padr√£o MAPA</li>
                    <li>üì• Download em Excel (.xlsx)</li>
                    <li>‚úÖ Pronto para envio</li>
                </ul>
            </div>
        </div>
        
        <!-- Upload Section -->
        <div class="upload-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">üì§</span>
                    <h2>Upload de NF-e</h2>
                </div>
            </div>
            
            <div class="upload-box">
                <span class="upload-icon">üìÑ</span>
                <h3>Arraste ou selecione seus arquivos</h3>
                <p>Aceita arquivos XML ou PDF de Nota Fiscal Eletr√¥nica</p>
                <form id="uploadForm">
                    <input type="file" id="xmlFile" accept=".xml,.pdf" required>
                    <button type="submit" class="btn btn-primary">
                        <span>üì§</span> Enviar Arquivo
                    </button>
                </form>
                <div id="uploadStatus" class="status-message" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Uploads Section -->
        <div class="uploads-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">üìã</span>
                    <h2>Arquivos Enviados</h2>
                </div>
                <div>
                    <span id="uploadCount" class="badge badge-primary">0 arquivos</span>
                </div>
            </div>
            
            <table id="uploadsTable">
                <thead>
                    <tr>
                        <th>Arquivo</th>
                        <th>Tipo</th>
                        <th>Data de Upload</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="uploadsTableBody">
                    <tr>
                        <td colspan="5" class="loading">
                            <div class="spinner"></div> Carregando uploads...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Generate Report Section -->
        <div class="upload-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">üéØ</span>
                    <h2>Gerar Relat√≥rio Trimestral MAPA</h2>
                </div>
            </div>
            
            <div class="alert alert-info">
                <span class="alert-icon">‚ÑπÔ∏è</span>
                <div class="alert-content">
                    <h4>Como gerar o relat√≥rio</h4>
                    <p>Selecione o trimestre desejado e clique em "Gerar Relat√≥rio". O sistema ir√° processar todos os arquivos enviados e criar o relat√≥rio no formato oficial do MAPA.</p>
                </div>
            </div>
            
            <form id="generateReportForm" style="max-width: 500px; margin: 20px auto;">
                <div class="form-group">
                    <label for="reportPeriod">Selecione o Trimestre</label>
                    <select id="reportPeriod" required style="width: 100%; padding: 14px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 15px; background: white;">
                        <option value="">-- Selecione --</option>
                        <option value="Q1-2025">1¬∫ Trimestre 2025 (Jan-Mar)</option>
                        <option value="Q2-2025">2¬∫ Trimestre 2025 (Abr-Jun)</option>
                        <option value="Q3-2025">3¬∫ Trimestre 2025 (Jul-Set)</option>
                        <option value="Q4-2025">4¬∫ Trimestre 2025 (Out-Dez)</option>
                        <option value="Q1-2024">1¬∫ Trimestre 2024 (Jan-Mar)</option>
                        <option value="Q2-2024">2¬∫ Trimestre 2024 (Abr-Jun)</option>
                        <option value="Q3-2024">3¬∫ Trimestre 2024 (Jul-Set)</option>
                        <option value="Q4-2024">4¬∫ Trimestre 2024 (Out-Dez)</option>
                    </select>
                </div>
                
                <div id="generateStatus" class="status-message" style="display: none;"></div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span>üìä</span> Gerar Relat√≥rio MAPA
                </button>
            </form>
        </div>
        
        <!-- Reports Section -->
        <div class="reports-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">üìä</span>
                    <h2>Relat√≥rios Gerados</h2>
                </div>
                <div>
                    <span id="reportCount" class="badge badge-success">0 relat√≥rios</span>
                </div>
            </div>
            
            <table id="reportsTable">
                <thead>
                    <tr>
                        <th>Per√≠odo</th>
                        <th>Data de Gera√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="reportsTableBody">
                    <tr>
                        <td colspan="3" class="loading">
                            <div class="spinner"></div> Carregando relat√≥rios...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/user.js"></script>
{% endblock %}