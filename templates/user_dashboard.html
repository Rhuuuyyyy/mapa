{% extends "base.html" %}

{% block title %}Dashboard - MAPA SaaS{% endblock %}

{% block content %}
<div class="dashboard">
    <header class="dashboard-header">
        <h1>ğŸ“Š Meus RelatÃ³rios MAPA</h1>
        <div class="header-actions">
            <span class="user-badge" id="userName">Carregando...</span>
            <button onclick="logout()" class="btn btn-secondary">Sair</button>
        </div>
    </header>
    
    <div class="dashboard-content">
        <!-- Info Cards -->
        <div class="info-cards">
            <div class="info-card">
                <div class="info-card-header">
                    <span class="info-card-icon">ğŸ“„</span>
                    <h3>Upload de NF-e</h3>
                </div>
                <p>FaÃ§a upload de suas Notas Fiscais EletrÃ´nicas nos formatos XML ou PDF (DANFE) para processamento automÃ¡tico.</p>
                <ul>
                    <li>âœ… Suporta XML de NF-e</li>
                    <li>âœ… Suporta PDF da DANFE</li>
                    <li>âœ… ExtraÃ§Ã£o automÃ¡tica de dados</li>
                </ul>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">
                    <span class="info-card-icon">âš™ï¸</span>
                    <h3>Processamento</h3>
                </div>
                <p>Os arquivos sÃ£o processados automaticamente apÃ³s o upload, extraindo todas as informaÃ§Ãµes relevantes.</p>
                <ul>
                    <li>ğŸ“¦ Dados do produto e garantias</li>
                    <li>ğŸ¢ Emitente e destinatÃ¡rio</li>
                    <li>ğŸ’° Valores e quantidades</li>
                </ul>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">
                    <span class="info-card-icon">ğŸ“Š</span>
                    <h3>RelatÃ³rio MAPA</h3>
                </div>
                <p>Gere o relatÃ³rio trimestral no formato oficial do MAPA com um clique.</p>
                <ul>
                    <li>ğŸ“‹ Formato padrÃ£o MAPA</li>
                    <li>ğŸ“¥ Download em Excel (.xlsx)</li>
                    <li>âœ… Pronto para envio</li>
                </ul>
            </div>
        </div>
        
        <!-- Upload Section -->
        <div class="upload-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">ğŸ“¤</span>
                    <h2>Upload de NF-e</h2>
                </div>
            </div>
            
            <div class="upload-box">
                <span class="upload-icon">ğŸ“„</span>
                <h3>Arraste ou selecione seus arquivos</h3>
                <p>Aceita arquivos XML ou PDF de Nota Fiscal EletrÃ´nica</p>
                <form id="uploadForm">
                    <input type="file" id="xmlFile" accept=".xml,.pdf" required>
                    <button type="submit" class="btn btn-primary">
                        <span>ğŸ“¤</span> Enviar Arquivo
                    </button>
                </form>
                <div id="uploadStatus" class="status-message" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Uploads Section -->
        <div class="uploads-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">ğŸ“‹</span>
                    <h2>Arquivos Enviados</h2>
                </div>
                <div>
                    <span id="uploadCount" class="badge badge-primary">0 arquivos</span>
                </div>
            </div>
            
            <table id="uploadsTable">
                <thead>
                    <tr>
                        <th>Arquivo</th>
                        <th>Tipo</th>
                        <th>Data de Upload</th>
                        <th>Status</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="uploadsTableBody">
                    <tr>
                        <td colspan="5" class="loading">
                            <div class="spinner"></div> Carregando uploads...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Generate Report Section -->
        <div class="upload-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">ğŸ¯</span>
                    <h2>Gerar RelatÃ³rio Trimestral MAPA</h2>
                </div>
            </div>
            
            <div class="alert alert-info">
                <span class="alert-icon">â„¹ï¸</span>
                <div class="alert-content">
                    <h4>Como gerar o relatÃ³rio</h4>
                    <p>Selecione o trimestre desejado e clique em "Gerar RelatÃ³rio". O sistema irÃ¡ processar todos os arquivos enviados e criar o relatÃ³rio no formato oficial do MAPA.</p>
                </div>
            </div>
            
            <form id="generateReportForm" style="max-width: 500px; margin: 20px auto;">
                <div class="form-group">
                    <label for="reportPeriod">Selecione o Trimestre</label>
                    <select id="reportPeriod" required style="width: 100%; padding: 14px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 15px; background: white;">
                        <option value="">-- Selecione --</option>
                        <option value="Q1-2025">1Âº Trimestre 2025 (Jan-Mar)</option>
                        <option value="Q2-2025">2Âº Trimestre 2025 (Abr-Jun)</option>
                        <option value="Q3-2025">3Âº Trimestre 2025 (Jul-Set)</option>
                        <option value="Q4-2025">4Âº Trimestre 2025 (Out-Dez)</option>
                        <option value="Q1-2024">1Âº Trimestre 2024 (Jan-Mar)</option>
                        <option value="Q2-2024">2Âº Trimestre 2024 (Abr-Jun)</option>
                        <option value="Q3-2024">3Âº Trimestre 2024 (Jul-Set)</option>
                        <option value="Q4-2024">4Âº Trimestre 2024 (Out-Dez)</option>
                    </select>
                </div>
                
                <div id="generateStatus" class="status-message" style="display: none;"></div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span>ğŸ“Š</span> Gerar RelatÃ³rio MAPA
                </button>
            </form>
        </div>
        
        <!-- Reports Section -->
        <div class="reports-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">ğŸ“Š</span>
                    <h2>RelatÃ³rios Gerados</h2>
                </div>
                <div>
                    <span id="reportCount" class="badge badge-success">0 relatÃ³rios</span>
                </div>
            </div>
            
            <table id="reportsTable">
                <thead>
                    <tr>
                        <th>PerÃ­odo</th>
                        <th>Data de GeraÃ§Ã£o</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="reportsTableBody">
                    <tr>
                        <td colspan="3" class="loading">
                            <div class="spinner"></div> Carregando relatÃ³rios...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/user.js"></script>
{% endblock %}